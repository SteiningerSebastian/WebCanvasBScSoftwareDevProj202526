syntax = "proto3";
package noredb;

option go_package = "github.com/SteiningerSebastian/webcanvas/grpc-general;noredb";

service Database {
    // Sets a data entry in the database
    rpc Set(Data) returns (Commit) {}
    
    // Retrieves a data entry from the database by key
    rpc Get(DataRequest) returns (DataResponse) {}

    // Streams all keys in the database
    rpc GetAll(StreamRequest) returns (stream DataResponse) {}
}

message Data {
    uint32 index = 1;  // The index of the transaction log
    uint32 key = 2;  // The key for the data entry
    bytes timestamp = 3; // The timestamp of the data entry
    bytes value = 4; // The value of the data entry
}

message DataRequest {
    uint32 index = 1; // The index of the transaction
    uint32 key = 2;  // The key for the data entry
}

message DataResponse {
    uint32 index = 1; // The index of the transaction
    uint32 key = 2;  // The key for the data entry
    bytes timestamp = 3; // The timestamp of the data entry
    bytes value = 4; // The value of the data entry
}

message Commit {
    uint32 index = 1; // The index of the transaction
    // 0b0000 = pending,
    // 0b0001 = success,
    // 0b0010 = failure, 
    // 0b0011 = unknown,
    // 0b0100 = aborted,
    // 0b0110 = rolled back
    int32 status = 2; 
}

message StreamRequest {
    uint32 index = 1; // The index of the transaction
}